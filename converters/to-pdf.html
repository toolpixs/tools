<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="PixTime by Time Load offers a free online multi-format to PDF converter. Convert any file to PDF in bulk with our fast, user-friendly tool. No software installation required.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="multi-format to PDF, file to PDF, online converter, bulk conversion, PixTime, Time Load">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Time Load">
  <meta name="googlebot" content="index, follow">
  <meta name="revisit-after" content="7 days">
  <meta name="distribution" content="global">
  <meta property="og:title" content="Multi-Format to PDF Converter - PixTime Free Online Tool">
  <meta property="og:description" content="Convert any file to PDF for free with PixTime. Fast, secure, no software needed. Ideal for bulk conversions.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.pix-time.com">
  <meta property="og:image" content="https://www.pix-time.com/images/pixtime-og-image.jpg">
  <meta property="og:site_name" content="PixTime">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="PixTime - Free Multi-Format to PDF Converter">
  <meta name="twitter:description" content="Effortlessly convert any file to PDF with PixTime. Fast, secure, and free with no downloads needed.">
  <meta name="twitter:image" content="https://www.pix-time.com/images/pixtime-og-image.jpg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <title>Multi-Format to PDF Converter - PixTime Free Online Tool</title>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "PixTime PDF Converter",
    "description": "Free online tool to convert any file to PDF. Fast, secure, and no software required. Ideal for bulk conversions.",
    "url": "https://www.pix-time.com",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "All",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Time Load",
      "url": "https://www.pix-time.com"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "reviewCount": "1200"
    },
    "featureList": [
      "Bulk file conversion",
      "Any file to PDF",
      "Secure local processing",
      "No software installation"
    ],
    "sameAs": [
      "https://twitter.com/pixtime",
      "https://www.facebook.com/pixtime"
    ]
  }
  </script>
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    :root {
      --primary: #2ecc71;
      --primary-dark: #27ae60;
      --secondary: #3498db;
      --secondary-dark: #2980b9;
      --danger: #e74c3c;
      --danger-dark: #c0392b;
      --text: #2c3e50;
      --text-light: #7f8c8d;
      --bg: #ecf0f1;
      --card-bg: #ffffff;
      --border: #dfe6e9;
      --shadow: rgba(0,0,0,0.15);
      --accent: #f1c40f;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --text: #ecf0f1;
        --text-light: #b0b5b5;
        --bg: #2c3e50;
        --card-bg: #34495e;
        --border: #4b5e7a;
        --shadow: rgba(0,0,0,0.4);
      }
      .file-card {
        background: var(--card-bg);
      }
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0.1rem;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background 0.3s ease, color 0.3s ease;
    }

    header {
      background-color: var(--bg);
      padding: 1.5rem 2rem;
      color: var(--text);
      box-shadow: 0 4px 10px var(--shadow);
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .desktop-nav {
      display: flex;
      gap: 2rem;
    }

    .desktop-nav a {
      color: var(--text);
      text-decoration: none;
      font-size: 1rem;
      padding: .5rem 0;
      position: relative;
      transition: transform 0.2s ease;
    }

    .desktop-nav a:hover {
      transform: translateY(-2px);
    }

    .desktop-nav a.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--accent);
    }

    .burger-icon {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      width: 44px;
      height: 44px;
      display: none;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .burger-icon:hover {
      background: rgba(0,0,0,0.15);
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100%;
      background: var(--card-bg);
      transition: left 0.3s ease;
      z-index: 101;
      box-shadow: 4px 0 15px var(--shadow);
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar nav {
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
    }

    .sidebar a {
      color: var(--text);
      text-decoration: none;
      padding: 1rem;
      border-radius: 8px;
      transition: background 0.2s, transform 0.2s;
    }

    .sidebar a:hover {
      background: rgba(0,0,0,0.1);
      transform: translateX(5px);
    }

    .sidebar a.active {
      font-weight: 600;
      background: rgba(46,204,113,0.15);
      color: var(--primary);
    }

    @media (max-width: 768px) {
      .desktop-nav {
        display: none;
      }
      .burger-icon {
        display: flex;
      }
      main {
        padding: 1rem;
      }
      .card, .upload-container, .file-table-container {
        max-width: 100%;
        margin: 0 0 1rem;
        padding: .8rem;
      }
      .upload-area {
        padding: .8rem;
        min-height: 60px;
        font-size: .8rem;
      }
      .upload-text {
        font-size: .9rem;
        margin-bottom: .2rem;
      }
      .upload-subtext {
        font-size: .7rem;
      }
      .upload-icon {
        font-size: 2rem;
        margin-bottom: .4rem;
      }
      .browse-btn {
        padding: .35rem .7rem;
        font-size: .75rem;
        margin-top: .4rem;
      }
      .floating-btn-container {
        max-width: 100%;
        padding: 0 8px;
        gap: 8px;
        justify-content: center;
      }
      .floating-btn {
        padding: 8px 16px;
        font-size: .85rem;
        min-width: 90px;
      }
      table {
        display: block;
      }
      table thead {
        display: none;
      }
      table tbody {
        display: block;
      }
      table tr {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: .8rem;
        background: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 2px 6px var(--shadow);
        padding: .6rem;
        opacity: 0;
        transform: translateY(10px);
        animation: fadeInRow .4s ease forwards;
      }
      table tr:nth-child(1) { animation-delay: .1s; }
      table tr:nth-child(2) { animation-delay: .2s; }
      table tr:nth-child(3) { animation-delay: .3s; }
      table tr:nth-child(4) { animation-delay: .4s; }
      table tr:nth-child(5) { animation-delay: .5s; }
      table td {
        display: flex;
        align-items: center;
        padding: .2rem 0;
        text-align: left;
        position: relative;
        font-size: .8rem;
      }
      .file-preview {
        width: 50px;
        height: 50px;
        margin-right: .5rem;
        border-radius: 6px;
      }
      .file-name {
        font-size: .85rem;
        max-width: 100%;
        padding-bottom: 0;
        flex: 1;
      }
      .file-size, .source-format, .file-format, .status {
        font-size: .75rem;
        color: var(--text-light);
      }
      .action-btn {
        font-size: .8rem;
        padding: .3rem .6rem;
      }
      .remove-btn {
        width: 28px;
        height: 28px;
        font-size: .9rem;
      }
      .row-progress {
        bottom: 0;
        height: 2px;
      }
      .file-size, .source-format, .file-format, .status {
        margin-right: .5rem;
      }
      table td:nth-child(1) {
        width: auto;
      }
      table td:nth-child(2) {
        flex: 1;
        margin-bottom: .2rem;
      }
      table td:nth-child(3), table td:nth-child(4), table td:nth-child(5), table td:nth-child(6) {
        flex: 0 0 auto;
      }
      table td:nth-child(7) {
        margin-top: .3rem;
        text-align: right;
        width: 100%;
      }
      .tooltip .tooltiptext {
        font-size: .7rem;
        width: 100px;
        bottom: 120%;
      }
    }

    main {
      flex: 1;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .card, .upload-container, .file-table-container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto 2rem;
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 12px var(--shadow);
      transition: transform .3s ease;
    }

    .error-container {
      display: none;
      background: var(--danger);
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      width: 100%;
      max-width: 900px;
    }

    .error-container.show {
      display: block;
    }

    .card:hover {
      transform: translateY(-4px);
    }

    h1 {
      font-size: 2.2rem;
      margin: 0 0 1.5rem;
      font-weight: 700;
      text-align: center;
    }

    h2 {
      font-size: 1.6rem;
      margin-bottom: 1.25rem;
      color: var(--text);
      font-weight: 600;
    }

    p, li {
      line-height: 1.7;
      color: var(--text-light);
    }

    ol, ul {
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: .75rem;
    }

    .upload-area {
      background: var(--card-bg);
      border: 3px dashed var(--border);
      padding: 1.5rem;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      transition: all .3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100px;
      position: relative;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(46,204,113,0.1);
      transform: scale(1.02);
    }

    .upload-area.dragover {
      border-color: var(--primary);
      background: rgba(46,204,113,0.15);
      transform: scale(1.03);
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: .8rem;
      color: var(--primary);
      transition: all .3s ease;
    }

    .upload-text {
      font-size: 1.2rem;
      margin-bottom: .5rem;
      color: var(--text);
      font-weight: 500;
    }

    .upload-subtext {
      font-size: .9rem;
      color: var(--text-light);
    }

    .upload-area input {
      display: none;
    }

    .browse-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: .75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s ease, transform .2s ease;
      margin-top: 1rem;
    }

    .browse-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .file-table-container {
      overflow-x: auto;
      display: none;
      position: relative;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table thead {
      background: rgba(0,0,0,0.05);
    }

    table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--text);
      border-bottom: 2px solid var(--border);
    }

    table tr {
      border-bottom: 1px solid var(--border);
      transition: all .2s ease;
    }

    @keyframes fadeInRow {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    table tr:hover {
      background: rgba(0,0,0,0.05);
    }

    table td {
      padding: 1rem;
      text-align: left;
      vertical-align: middle;
      position: relative;
    }

    .file-preview {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .file-name {
      font-weight: 500;
      color: var(--text);
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding-bottom: .5rem;
    }

    .file-size {
      color: var(--text-light);
    }

    .file-format, .source-format {
      font-weight: 500;
      text-transform: uppercase;
    }

    .action-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: .5rem 1rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all .2s ease;
      text-decoration: none;
      border: none;
      font-size: .9rem;
    }

    .remove-btn {
      background: none;
      color: var(--text);
      padding: .5rem;
      border-radius: 50%;
      width: 36px;
      height: 36px;
    }

    .remove-btn:hover {
      background: rgba(231,76,60,0.15);
    }

    .download-btn {
      background: var(--secondary);
      color: white;
    }

    .download-btn:hover {
      background: var(--secondary-dark);
      transform: translateY(-2px);
      box-shadow: 0 3px 8px var(--shadow);
    }

    .status-converting {
      color: var(--primary);
      font-weight: 500;
    }

    .status-error {
      color: var(--danger);
      font-weight: 500;
    }

    .floating-btn-container {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      z-index: 2;
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
      padding: 0 20px;
    }

    .floating-btn {
      background: white;
      color: var(--text);
      border: none;
      border-radius: 50px;
      padding: 14px 28px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px var(--shadow);
      transition: transform .3s ease, box-shadow .3s ease, background .2s ease;
    }

    .floating-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow);
    }

    .floating-btn:disabled {
      background: var(--text-light);
      color: var(--card-bg);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    #convertBtn {
      background: var(--primary);
      color: white;
    }

    #convertBtn:hover:enabled {
      background: var(--primary-dark);
    }

    #downloadSeparateBtn {
      background: var(--secondary);
      color: white;
    }

    #downloadSeparateBtn:hover:enabled {
      background: var(--secondary-dark);
    }

    #downloadCombinedBtn {
      background: var(--accent);
      color: var(--text);
    }

    #downloadCombinedBtn:hover:enabled {
      background: #e1b80d;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity .3s ease;
    }

    .modal-overlay.show {
      display: flex;
      opacity: 1;
    }

    .modal {
      background: var(--card-bg);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 16px var(--shadow);
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.8);
      opacity: 0;
      transition: transform .3s ease, opacity .3s ease;
    }

    .modal.show {
      transform: scale(1);
      opacity: 1;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.4rem;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      transition: color .2s;
    }

    .modal-close:hover {
      color: var(--text);
    }

    .image-list {
      list-style: none;
      padding: 0;
      margin: 0 0 24px;
    }

    .image-item {
      display: flex;
      align-items: center;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
      background: var(--card-bg);
      cursor: move;
      transition: background .2s;
      position: relative;
    }

    .image-item.dragging {
      opacity: 0.5;
      background: rgba(46,204,113,0.1);
    }

    .image-item.drop-target::before {
      content: '';
      position: absolute;
      top: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--primary);
    }

    .image-item.drop-target-bottom::before {
      top: auto;
      bottom: -2px;
    }

    .image-item:hover {
      background: rgba(0,0,0,0.05);
    }

    .drag-handle {
      font-size: 1.2rem;
      margin-right: 16px;
      color: var(--text-light);
      cursor: grab;
    }

    .image-preview {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid var(--border);
      margin-right: 16px;
      cursor: pointer;
    }

    .image-info {
      flex: 1;
    }

    .image-info .page-number {
      font-weight: 600;
      color: var(--primary);
    }

    .image-info .file-name {
      font-size: .9rem;
      color: var(--text-light);
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
    }

    .modal-btn {
      padding: 9.6px 19.2px;
      border: none;
      border-radius: 8px;
      font-size: .9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s ease, transform .2s ease;
    }

    .modal-btn.cancel {
      background: var(--danger);
      color: white;
    }

    .modal-btn.cancel:hover {
      background: var(--danger-dark);
      transform: translateY(-2px);
    }

    .modal-btn.confirm {
      background: var(--primary);
      color: white;
    }

    .modal-btn.confirm:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .image-preview-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity .3s ease;
    }

    .image-preview-overlay.show {
      display: flex;
      opacity: 1;
    }

    .image-preview-container {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      padding: 16px;
    }

    .image-preview-img {
      max-width: 100%;
      max-height: 80vh;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 20px var(--shadow);
    }

    .image-preview-close {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--card-bg);
      border: none;
      font-size: 1.5rem;
      color: var(--text);
      cursor: pointer;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .2s;
    }

    .image-preview-close:hover {
      background: var(--primary);
      color: white;
    }

    @media (max-width: 768px) {
      .modal {
        width: 95%;
        padding: 16px;
      }
      .image-item {
        padding: 8px;
      }
      .image-preview {
        width: 40px;
        height: 40px;
      }
      .drag-handle {
        font-size: 1rem;
        margin-right: 8px;
      }
      .image-info .file-name {
        font-size: .8rem;
      }
      .image-preview-container {
        padding-bottom: 16px;
      }
      .floating-btn-container {
        gap: 10px;
        padding: 0 10px;
      }
      .floating-btn {
        padding: 10px 20px;
        font-size: .9rem;
        min-width: 80px;
      }
    }

    @media (max-width: 600px) {
      .modal-header h2 {
        font-size: 1.2rem;
      }
      .modal-btn {
        padding: 8px 16px;
        font-size: .85rem;
      }
      .image-preview-close {
        top: -8px;
        right: -8px;
        width: 28px;
        height: 28px;
        font-size: 1.2rem;
      }
      .floating-btn-container {
        flex-wrap: wrap;
        gap: 8px;
      }
      .floating-btn {
        padding: 8px 16px;
        font-size: .8rem;
        min-width: 70px;
      }
    }

    footer {
      background: var(--card-bg);
      color: var(--text);
      text-align: center;
      padding: 2rem;
      margin-top: 2rem;
      box-shadow: 0 -4px 10px var(--shadow);
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    footer nav {
      display: flex;
      justify-content: center;
      gap: 2rem;
      width: 100%;
      max-width: 900px;
      margin: 1rem auto;
      flex-wrap: wrap;
    }

    footer nav a {
      color: var(--text-light);
      text-decoration: none;
      padding: .5rem 1rem;
      font-size: .9rem;
      transition: color .2s ease;
    }

    footer nav a:hover {
      color: var(--primary);
    }

    @media (max-width: 480px) {
      footer nav {
        flex-direction: column;
        align-items: center;
        gap: .5rem;
      }
    }

    .ad-space {
      font-size: .9rem;
      margin-top: 1.5rem;
      background: rgba(0,0,0,0.05);
      padding: 1rem;
      border-radius: 12px;
      width: 100%;
      max-width: 900px;
      color: var(--text-light);
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 120px;
      background: var(--text);
      color: white;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 2;
      bottom: 130%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity .3s;
      margin-bottom: 5px;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 2s 5; /* Limited to 5 iterations */
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo">PixTime</div>
      <nav class="desktop-nav" aria-label="Main navigation">
        <a href="#" class="active">To PDF</a>
        <a href="#">PNG to JPG</a>
        <a href="#">JPG to PNG</a>
        <a href="#">WebP to PNG</a>
        <a href="#">Chat with AI</a>
      </nav>
      <button class="burger-icon" aria-label="Toggle menu">☰</button>
    </div>
    <div class="sidebar">
      <nav aria-label="Mobile navigation">
        <a href="#" class="active">To PDF</a>
        <a href="#">PNG to JPG</a>
        <a href="#">JPG to PNG</a>
        <a href="#">WebP to PNG</a>
        <a href="#">Chat with AI</a>
      </nav>
    </div>
  </header>

  <main>
    <h1>Multi-Format to PDF Converter - PixTime Free Online Tool</h1>
    <div class="error-container" id="errorContainer">
      <p id="errorMessage"></p>
    </div>
    <div class="upload-container">
      <div class="upload-area pulse" id="uploadArea" role="button" tabindex="0" aria-label="Upload files" aria-describedby="uploadSubtext">
        <div class="upload-icon">📂</div>
        <p class="upload-text">Drag & Drop Files Here</p>
        <button class="browse-btn">Browse</button>
        <p class="upload-subtext" id="uploadSubtext">Supports images (PNG, JPG, WEBP, GIF, BMP), Excel (XLSX), Word (DOCX), text (TXT), and more</p>
        <input type="file" id="fileInput" multiple aria-hidden="true">
      </div>
    </div>

    <div class="file-table-container" id="fileTableContainer">
      <table id="fileTable" role="grid" aria-live="polite">
        <thead>
          <tr>
            <th scope="col">Preview</th>
            <th scope="col">File Name</th>
            <th scope="col">Size</th>
            <th scope="col">From</th>
            <th scope="col">To</th>
            <th scope="col">Status</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="fileTableBody">
          <!-- Files will be added here dynamically -->
        </tbody>
      </table>
    </div>

    <div class="card introduction">
      <h2>Convert Any File to PDF with PixTime</h2>
      <p>Welcome to <strong>PixTime's Multi-Format to PDF Converter</strong>, a free online tool by Time Load. Convert any file, including images, Excel, Word, text, and more, to PDF in bulk with ease. Download as separate PDFs or combine into a single PDF with customizable page order. No software installation required – ideal for all your conversion needs!</p>
    </div>

    <div class="card features">
      <h2>Why Use PixTime's Converter?</h2>
      <ul>
        <li><strong>Universal Support:</strong> Convert any file type to PDF, including images, documents, and text.</li>
        <li><strong>Bulk Conversion:</strong> Process multiple files at once.</li>
        <li><strong>Flexible Output:</strong> Download separate PDFs or a combined PDF with drag-and-drop reordering.</li>
        <li><strong>No Software Needed:</strong> Fully browser-based.</li>
        <li><strong>Fast and Secure:</strong> Local processing ensures speed and privacy.</li>
        <li><strong>User-Friendly:</strong> Intuitive interface for all users.</li>
      </ul>
    </div>

    <div class="card how-to-use">
      <h2>How to Use the Converter</h2>
      <ol>
        <li>Drag and drop or click to upload any files you wish to convert.</li>
        <li>View uploaded files in the table with real-time previews (where applicable).</li>
        <li>Click 'Convert All' to transform files to PDFs.</li>
        <li>Download individually ('Download Separately') or as a single PDF ('Download Combined') with page reordering.</li>
      </ol>
    </div>

    <div class="card about">
      <h2>About Time Load and PixTime</h2>
      <p><strong>Time Load</strong> creates innovative tools to simplify digital tasks. <strong>PixTime</strong> is our suite of file processing solutions, offering seamless conversion for any file to PDF. Designed for professionals and casual users alike, our tools save time and enhance productivity.</p>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <nav aria-label="Footer navigation">
        <a href="../" class="tooltip">Home<span class="tooltiptext">Back to Homepage</span></a>
        <a href="../converter" class="tooltip">Converters<span class="tooltiptext">Explore All Tools</span></a>
        <a href="../terms" class="tooltip">Terms<span class="tooltiptext">Terms of Service</span></a>
        <a href="../privacy" class="tooltip">Policy<span class="tooltiptext">Privacy Policy</span></a>
        <a href="../blog" class="tooltip">Blog<span class="tooltiptext">Read Our Blog</span></a>
      </nav>
      <p>© 2025 Time Load. All Rights Reserved.</p>
      <div class="ad-space">Advertisement</div>
    </div>
  </footer>

  <div class="floating-btn-container">
    <button class="floating-btn" id="convertBtn" aria-label="Convert all files to PDF" disabled>Convert All</button>
    <button class="floating-btn" id="downloadSeparateBtn" aria-label="Download all converted files separately" disabled>Download Separately</button>
    <button class="floating-btn" id="downloadCombinedBtn" aria-label="Download all converted files as combined PDF" disabled>Download Combined</button>
  </div>

  <div class="modal-overlay" id="pageOrderModal" role="dialog" aria-labelledby="pageOrderModalTitle" aria-modal="true">
    <div class="modal">
      <div class="modal-header">
        <h2 id="pageOrderModalTitle">Arrange PDF Page Order</h2>
        <button class="modal-close" id="modalClose" aria-label="Close modal">×</button>
      </div>
      <p>Drag and drop files to reorder pages in the combined PDF. Click images to preview.</p>
      <ul class="image-list" id="imageList"></ul>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="modalCancel" aria-label="Cancel">Cancel</button>
        <button class="modal-btn confirm" id="modalConfirm" aria-label="Confirm and download">Confirm & Download</button>
      </div>
    </div>
  </div>

  <div class="image-preview-overlay" id="imagePreviewModal" role="dialog" aria-labelledby="imagePreviewModalTitle" aria-modal="true">
    <div class="image-preview-container">
      <img src="" alt="Image Preview" class="image-preview-img" id="previewImage">
      <button class="image-preview-close" id="imagePreviewClose" aria-label="Close image preview">×</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Check for library availability
    if (!window.PDFLib || !window.XLSX || !window.html2canvas) {
      alert('Required libraries (PDFLib, XLSX, or html2canvas) are not available. Please ensure you have an internet connection and try again.');
    }

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileTableContainer = document.getElementById('fileTableContainer');
    const fileTableBody = document.getElementById('fileTableBody');
    const convertBtn = document.getElementById('convertBtn');
    const downloadSeparateBtn = document.getElementById('downloadSeparateBtn');
    const downloadCombinedBtn = document.getElementById('downloadCombinedBtn');
    const burgerIcon = document.querySelector('.burger-icon');
    const sidebar = document.querySelector('.sidebar');
    const pageOrderModal = document.getElementById('pageOrderModal');
    const imageList = document.getElementById('imageList');
    const modalClose = document.getElementById('modalClose');
    const modalCancel = document.getElementById('modalCancel');
    const modalConfirm = document.getElementById('modalConfirm');
    const imagePreviewModal = document.getElementById('imagePreviewModal');
    const previewImage = document.getElementById('previewImage');
    const imagePreviewClose = document.getElementById('imagePreviewClose');
    const errorContainer = document.getElementById('errorContainer');
    const errorMessage = document.getElementById('errorMessage');

    let selectedFiles = [];
    let combinedPdfUrl = null;
    let previewUrls = new Map();

    // Clean up URLs on page unload
    window.addEventListener('beforeunload', cleanupUrls);

    burgerIcon.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      burgerIcon.textContent = sidebar.classList.contains('open') ? '×' : '☰';
      burgerIcon.setAttribute('aria-label', sidebar.classList.contains('open') ? 'Close menu' : 'Open menu');
      document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
    });

    document.addEventListener('click', function(e) {
      if (
          sidebar.classList.contains('open') &&
          !sidebar.contains(e.target) &&
          e.target !== null &&
          !burgerIcon.contains(e.target)
      ) {
          sidebar.classList.remove('open');
          burgerIcon.textContent = '☰';
          burgerIcon.setAttribute('aria-label', 'Open menu');
          document.body.style.overflow = '';
      }
      if (pageOrderModal.classList.contains('show') && e.target === pageOrderModal) {
          closeModal();
      }
      if (imagePreviewModal.classList.contains('show') && e.target === imagePreviewModal) {
          closeImagePreview();
      }
    });

    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      handleFiles(files);
    });
    fileInput.addEventListener('change', () => {
      const files = Array.from(fileInput.files);
      handleFiles(files);
      fileInput.value = ''; // Reset input for multiple uploads
    });
    uploadArea.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        fileInput.click();
      }
    });

    function handleFiles(files) {
      files.forEach(file => {
        const extension = file.name.split('.').pop().toLowerCase();
        selectedFiles.push({
          id: Date.now() + Math.random().toString(36).substr(2, 9),
          file,
          sourceType: extension.toUpperCase(),
          converted: false,
          downloadUrl: null,
          status: 'Pending'
        });
      });
      if (files.length > 0) {
        renderTable();
        fileTableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function renderTable() {
      fileTableBody.innerHTML = '';
      errorContainer.classList.remove('show');

      if (selectedFiles.length === 0) {
        fileTableContainer.style.display = 'none';
        convertBtn.style.display = 'none';
        downloadSeparateBtn.style.display = 'none';
        downloadCombinedBtn.style.display = 'none';
        convertBtn.disabled = true;
        downloadSeparateBtn.disabled = true;
        downloadCombinedBtn.disabled = true;
        return;
      }

      fileTableContainer.style.display = 'block';
      const needConversion = selectedFiles.some(f => !f.converted);
      convertBtn.style.display = needConversion ? 'inline-block' : 'none';
      convertBtn.disabled = !needConversion;

      selectedFiles.forEach((item, index) => {
        const { id, converted, file, downloadUrl, sourceType, status } = item;
        let fileUrl = null;
        const isImage = ['image/png', 'image/jpeg', 'image/webp', 'image/gif', 'image/bmp'].includes(file.type) ||
                        /\.(png|jpe?g|webp|gif|bmp)$/i.test(file.name);
        if (isImage && !converted) {
          fileUrl = URL.createObjectURL(file);
          previewUrls.set(id, fileUrl);
        }
        const fileName = file.name;
        const fileSize = (file.size / 1024).toFixed(2);
        const shortName = fileName.length > 20 ? fileName.substring(0, 17) + '...' : fileName;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td role="gridcell">${isImage && !converted ? `<img src="${fileUrl}" alt="Preview of ${fileName}" class="file-preview">` : '<span class="empty-icon">📄</span>'}</td>
          <td role="gridcell" class="file-name tooltip" title="${fileName}">${shortName}</td>
          <td role="gridcell" class="file-size">${fileSize} KB</td>
          <td role="gridcell" class="source-format">${sourceType}</td>
          <td role="gridcell" class="file-format">PDF</td>
          <td role="gridcell" class="${status === 'Converting' ? 'status-converting' : status === 'Failed' ? 'status-error' : ''}">${status}</td>
          <td role="gridcell">
            ${
              converted ?
                `<a href="${downloadUrl}" download="${fileName.replace(/\.[^/.]+$/, '')}.pdf" class="action-btn download-btn tooltip" aria-label="Download ${fileName} as PDF" title="Download File">Download</a>` :
                `<button class="action-btn remove-btn tooltip" onclick="removeFile(${index})" aria-label="Remove ${fileName}" title="Remove File">×</button>`
            }
          </td>
        `;
        fileTableBody.appendChild(row);
      });

      setupDownloadButtons();
    }

    function removeFile(index) {
      const item = selectedFiles[index];
      if (previewUrls.has(item.id)) {
        URL.revokeObjectURL(previewUrls.get(item.id));
        previewUrls.delete(item.id);
      }
      if (item.downloadUrl) {
        URL.revokeObjectURL(item.downloadUrl);
      }
      selectedFiles.splice(index, 1);
      if (combinedPdfUrl) {
        URL.revokeObjectURL(combinedPdfUrl);
        combinedPdfUrl = null;
      }
      renderTable();
    }

    function cleanupUrls() {
      previewUrls.forEach(url => URL.revokeObjectURL(url));
      previewUrls.clear();
      selectedFiles.forEach(item => {
        if (item.downloadUrl) {
          URL.revokeObjectURL(item.downloadUrl);
          item.downloadUrl = null;
        }
      });
      if (combinedPdfUrl) {
        URL.revokeObjectURL(combinedPdfUrl);
        combinedPdfUrl = null;
      }
    }

    async function convertImageToPDF(file) {
      const reader = new FileReader();
      return new Promise((resolve, reject) => {
        reader.onerror = () => reject(new Error(`Failed to read file ${file.name}`));
        reader.readAsDataURL(file);
        reader.onload = async function(event) {
          const img = new Image();
          img.onerror = () => reject(new Error(`Failed to load image ${file.name}`));
          img.onload = async function() {
            try {
              const pdfDoc = await PDFLib.PDFDocument.create();
              const page = pdfDoc.addPage([img.width, img.height]);
              let image;
              const fileType = (file.type || file.name.split('.').pop().toLowerCase()).replace('jpeg', 'jpg');
              if (['webp', 'png', 'gif', 'bmp'].includes(fileType)) {
                image = await pdfDoc.embedPng(event.target.result);
              } else if (fileType.includes('jpg')) {
                image = await pdfDoc.embedJpg(event.target.result);
              } else {
                throw new Error('Unsupported image format');
              }
              page.drawImage(image, { x: 0, y: 0, width: img.width, height: img.height });
              const pdfBytes = await pdfDoc.save();
              const blob = new Blob([pdfBytes], { type: 'application/pdf' });
              resolve({ blob, width: img.width, height: img.height });
            } catch (error) {
              reject(new Error(`Failed to convert image ${file.name}: ${error.message}`));
            }
          };
          img.src = event.target.result;
        };
      });
    }

    async function convertExcelToPDF(file) {
      const reader = new FileReader();
      return new Promise((resolve, reject) => {
        reader.onerror = () => reject(new Error(`Failed to read Excel file ${file.name}`));
        reader.readAsArrayBuffer(file);
        reader.onload = async function(event) {
          try {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            if (!firstSheet) throw new Error('No sheets found in Excel file');
            const htmlString = XLSX.utils.sheet_to_html(firstSheet);

            const container = document.createElement('div');
            container.innerHTML = htmlString;
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.backgroundColor = 'transparent';

            const table = container.querySelector('table');
            if (table) {
              table.style.borderCollapse = 'collapse';
              table.style.backgroundColor = 'transparent';
              table.style.color = '#000000';
              table.style.fontFamily = 'Arial, sans-serif';
              table.style.fontSize = '12px';

              const cells = table.querySelectorAll('td, th');
              cells.forEach(cell => {
                cell.style.border = '1px solid #000000';
                cell.style.padding = '5px';
                cell.style.backgroundColor = 'transparent';
                cell.style.color = '#000000';
              });
            }

            document.body.appendChild(container);

            const canvas = await html2canvas(container, { 
              scale: 2,
              backgroundColor: null
            });
            const imgData = canvas.toDataURL('image/png');
            const pdfDoc = await PDFLib.PDFDocument.create();
            const page = pdfDoc.addPage([canvas.width / 2, canvas.height / 2]);
            const image = await pdfDoc.embedPng(imgData);
            page.drawImage(image, { x: 0, y: 0, width: canvas.width / 2, height: canvas.height / 2 });

            document.body.removeChild(container);

            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            resolve({ blob, width: canvas.width / 2, height: canvas.height / 2 });
          } catch (error) {
            reject(new Error(`Failed to convert Excel file ${file.name}: ${error.message}`));
          }
        };
      });
    }

    async function convertTextToPDF(file) {
      const reader = new FileReader();
      return new Promise((resolve, reject) => {
        reader.onerror = () => reject(new Error(`Failed to read text file ${file.name}`));
        reader.readAsText(file);
        reader.onload = async function(event) {
          try {
            const text = event.target.result;
            const pdfDoc = await PDFLib.PDFDocument.create();
            let page = pdfDoc.addPage([595, 842]);
            let font;
            try {
              font = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesRoman);
            } catch (e) {
              throw new Error(`Failed to embed font: ${e.message}`);
            }
            const fontSize = 12;
            const lines = text.split('\n');
            let y = 800;

            for (const line of lines) {
              const cleanLine = line.replace(/[^\x00-\x7F]/g, '?');
              if (y < 50) {
                page = pdfDoc.addPage([595, 842]);
                y = 800;
              }
              const lineWidth = font.widthOfTextAtSize(cleanLine, fontSize);
              if (lineWidth > 495) {
                const words = cleanLine.split(' ');
                let currentLine = '';
                for (const word of words) {
                  const testLine = currentLine ? `${currentLine} ${word}` : word;
                  if (font.widthOfTextAtSize(testLine, fontSize) > 495) {
                    page.drawText(currentLine, { x: 50, y, font, size: fontSize });
                    y -= fontSize + 5;
                    if (y < 50) {
                      page = pdfDoc.addPage([595, 842]);
                      y = 800;
                    }
                    currentLine = word;
                  } else {
                    currentLine = testLine;
                  }
                }
                if (currentLine) {
                  page.drawText(currentLine, { x: 50, y, font, size: fontSize });
                  y -= fontSize + 5;
                }
              } else {
                page.drawText(cleanLine, { x: 50, y, font, size: fontSize });
                y -= fontSize + 5;
              }
            }

            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            resolve({ blob, width: 595, height: 842 });
          } catch (error) {
            reject(new Error(`Failed to convert text file ${file.name}: ${error.message}`));
          }
        };
      });
    }

    async function convertDocxToPDF(file) {
      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('https://byteai.pythonanywhere.com/docx-to-pdf', {
          method: 'POST',
          body: formData,
          signal: AbortSignal.timeout(30000) // 30s timeout
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.statusText}`);
        }

        const blob = await response.blob();
        return { blob, width: 595, height: 842 };
      } catch (error) {
        console.warn(`DOCX conversion failed for ${file.name}: ${error.message}. Falling back to generic conversion.`);
        return await convertGenericToPDF(file);
      }
    }

    async function convertGenericToPDF(file) {
      try {
        const pdfDoc = await PDFLib.PDFDocument.create();
        const page = pdfDoc.addPage([595, 842]);
        let font;
        try {
          font = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesRoman);
        } catch (e) {
          throw new Error(`Failed to embed font: ${e.message}`);
        }
        const fontSize = 20;
        const text = `Unsupported File Format: ${file.name}\n\nThis file type is not fully supported for conversion.\nMetadata:\n- Type: ${file.type || 'Unknown'}\n- Size: ${(file.size / 1024).toFixed(2)} KB`;
        page.drawText(text, { x: 50, y: 800, font, size: fontSize });
        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        return { blob, width: 595, height: 842 };
      } catch (error) {
        throw new Error(`Failed to convert file ${file.name}: ${error.message}`);
      }
    }

    convertBtn.addEventListener('click', async () => {
      convertBtn.disabled = true;
      convertBtn.textContent = 'Converting...';
      combinedPdfUrl = null;
      const errors = [];
      errorContainer.classList.remove('show');

      try {
        for (let i = 0; i < selectedFiles.length; i++) {
          const item = selectedFiles[i];
          if (item.converted) continue;

          item.status = 'Converting';
          renderTable();

          try {
            let result;
            const file = item.file;
            const extension = file.name.split('.').pop().toLowerCase();
            const isImage = ['image/png', 'image/jpeg', 'image/webp', 'image/gif', 'image/bmp'].includes(file.type) ||
                            /\.(png|jpe?g|webp|gif|bmp)$/i.test(file.name);
            const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                            /\.(xlsx)$/i.test(file.name);
            const isText = file.type === 'text/plain' || /\.(txt)$/i.test(file.name);
            const isDocx = file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||
                           /\.(docx)$/i.test(file.name);

            if (isImage) {
              result = await convertImageToPDF(file);
            } else if (isExcel) {
              result = await convertExcelToPDF(file);
            } else if (isText) {
              result = await convertTextToPDF(file);
            } else if (isDocx) {
              result = await convertDocxToPDF(file);
            } else {
              result = await convertGenericToPDF(file);
            }

            const { blob } = result;
            selectedFiles[i].converted = true;
            selectedFiles[i].downloadUrl = URL.createObjectURL(blob);
            selectedFiles[i].status = 'Converted';
          } catch (error) {
            selectedFiles[i].status = 'Failed';
            errors.push(`• ${item.file.name}: ${error.message}`);
            console.error(error);
          }
          renderTable();
        }

        if (errors.length > 0) {
          errorMessage.textContent = `Some files failed to convert:\n${errors.join('\n')}`;
          errorContainer.classList.add('show');
        }

        convertBtn.textContent = '✓ Converted!';
        setTimeout(() => {
          convertBtn.textContent = 'Convert All';
          renderTable();
        }, 3000);
      } catch (error) {
        errorMessage.textContent = `An unexpected error occurred: ${error.message}`;
        errorContainer.classList.add('show');
        console.error(error);
        convertBtn.textContent = 'Convert All';
      } finally {
        convertBtn.disabled = false;
      }
    });

    function setupDownloadButtons() {
      const convertedItems = selectedFiles.filter(item => item.converted);

      if (convertedItems.length === 0) {
        downloadSeparateBtn.style.display = 'none';
        downloadCombinedBtn.style.display = 'none';
        downloadSeparateBtn.disabled = true;
        downloadCombinedBtn.disabled = true;
        return;
      }

      downloadSeparateBtn.style.display = convertedItems.length > 1 ? 'inline-block' : 'none';
      downloadCombinedBtn.style.display = 'inline-block';
      downloadSeparateBtn.disabled = false;
      downloadCombinedBtn.disabled = false;

      downloadSeparateBtn.textContent = `Download Separately (${convertedItems.length})`;
      downloadSeparateBtn.onclick = () => {
        convertedItems.forEach((item) => {
          const link = document.createElement('a');
          link.href = item.downloadUrl;
          link.download = item.file.name.replace(/\.[^/.]+$/, '') + '.pdf';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      };

      downloadCombinedBtn.textContent = convertedItems.length === 1 ? 'Download' : 'Download Combined';
      downloadCombinedBtn.onclick = () => {
        if (convertedItems.length === 0) return;

        if (convertedItems.length === 1) {
          const link = document.createElement('a');
          link.href = convertedItems[0].downloadUrl;
          link.download = convertedItems[0].file.name.replace(/\.[^/.]+$/, '') + '.pdf';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          return;
        }

        renderImageList();
        pageOrderModal.classList.add('show');
        document.body.style.overflow = 'hidden';
        modalConfirm.focus(); // Set focus to confirm button
      };
    }

    function renderImageList() {
      imageList.innerHTML = '';
      const convertedItems = selectedFiles.filter(item => item.converted);

      convertedItems.forEach((item, index) => {
        const li = document.createElement('li');
        li.className = 'image-item';
        li.draggable = true;
        li.dataset.id = item.id;

        let fileUrl = null;
        const isImage = ['image/png', 'image/jpeg', 'image/webp', 'image/gif', 'image/bmp'].includes(item.file.type) ||
                        /\.(png|jpe?g|webp|gif|bmp)$/i.test(item.file.name);
        if (isImage) {
          fileUrl = previewUrls.get(item.id) || URL.createObjectURL(item.file);
          previewUrls.set(item.id, fileUrl);
        }
        const fileName = item.file.name;
        const shortName = fileName.length > 20 ? fileName.substring(0, 17) + '...' : fileName;

        li.innerHTML = `
          <span class="drag-handle">☰</span>
          ${isImage ? `<img src="${fileUrl}" alt="Preview of ${fileName}" class="image-preview" data-id="${item.id}">` : '<span class="empty-icon">📄</span>'}
          <div class="image-info">
            <span class="page-number">Page ${index + 1}</span>
            <span class="file-name">${shortName}</span>
          </div>
        `;

        li.addEventListener('dragstart', (e) => {
          e.target.classList.add('dragging');
          e.dataTransfer.setData('text/plain', item.id);
        });

        li.addEventListener('dragend', (e) => {
          e.target.classList.remove('dragging');
          Array.from(imageList.children).forEach(child => {
            child.classList.remove('drop-target', 'drop-target-bottom');
          });
        });

        li.addEventListener('dragover', (e) => {
          e.preventDefault();
          const draggingItem = document.querySelector('.dragging');
          if (draggingItem === li) return;

          const rect = li.getBoundingClientRect();
          const midpoint = rect.top + rect.height / 2;
          const isAbove = e.clientY < midpoint;

          Array.from(imageList.children).forEach(child => {
            child.classList.remove('drop-target', 'drop-target-bottom');
          });

          li.classList.add(isAbove ? 'drop-target' : 'drop-target-bottom');
        });

        li.addEventListener('dragleave', () => {
          li.classList.remove('drop-target', 'drop-target-bottom');
        });

        li.addEventListener('drop', (e) => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData('text/plain');
          const draggedItem = imageList.querySelector(`[data-id="${draggedId}"]`);
          if (draggedItem === li) return;

          const rect = li.getBoundingClientRect();
          const midpoint = rect.top + rect.height / 2;
          const isAbove = e.clientY < midpoint;

          if (isAbove) {
            imageList.insertBefore(draggedItem, li);
          } else {
            imageList.insertBefore(draggedItem, li.nextSibling);
          }

          Array.from(imageList.children).forEach(child => {
            child.classList.remove('drop-target', 'drop-target-bottom');
          });

          updateFileOrder();
        });

        if (isImage) {
          const img = li.querySelector('.image-preview');
          img.addEventListener('click', () => {
            previewImage.src = fileUrl;
            imagePreviewModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            imagePreviewClose.focus();
          });
        }

        imageList.appendChild(li);
      });
    }

    function updateFileOrder() {
      const newOrder = Array.from(imageList.children).map(item => item.dataset.id);
      const reorderedFiles = [];

      newOrder.forEach(id => {
        const file = selectedFiles.find(f => f.id === id);
        if (file) reorderedFiles.push(file);
      });

      selectedFiles = reorderedFiles;
      renderImageList();
    }

    modalClose.addEventListener('click', closeModal);
    modalCancel.addEventListener('click', closeModal);

    function closeModal() {
      pageOrderModal.classList.remove('show');
      document.body.style.overflow = imagePreviewModal.classList.contains('show') ? 'hidden' : '';
      uploadArea.focus(); // Return focus to upload area
    }

    imagePreviewClose.addEventListener('click', closeImagePreview);

    function closeImagePreview() {
      imagePreviewModal.classList.remove('show');
      previewImage.src = '';
      document.body.style.overflow = pageOrderModal.classList.contains('show') ? 'hidden' : '';
      modalConfirm.focus(); // Return focus to confirm button
    }

    modalConfirm.addEventListener('click', async () => {
      try {
        const convertedItems = selectedFiles.filter(item => item.converted);
        if (convertedItems.length === 0) {
          errorMessage.textContent = 'No converted files available to combine.';
          errorContainer.classList.add('show');
          closeModal();
          return;
        }

        const pdfDoc = await PDFLib.PDFDocument.create();
        let hasPages = false;

        for (const item of convertedItems) {
          try {
            const externalPdfBytes = await (await fetch(item.downloadUrl)).arrayBuffer();
            const externalDoc = await PDFLib.PDFDocument.load(externalPdfBytes);
            const copiedPages = await pdfDoc.copyPages(externalDoc, externalDoc.getPageIndices());
            copiedPages.forEach(page => {
              pdfDoc.addPage(page);
              hasPages = true;
            });
          } catch (e) {
            console.error(`Failed to process file ${item.file.name} for combined PDF: ${e.message}`);
          }
        }

        if (!hasPages) {
          throw new Error('No valid pages were found to combine.');
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        if (combinedPdfUrl) {
          URL.revokeObjectURL(combinedPdfUrl);
        }
        combinedPdfUrl = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = combinedPdfUrl;
        link.download = 'combined.pdf';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        closeModal();
      } catch (error) {
        errorMessage.textContent = `An error occurred while generating the combined PDF: ${error.message}`;
        errorContainer.classList.add('show');
        console.error(error);
        closeModal();
      }
    });

    // Focus trapping for modals
    function trapFocus(modal, firstFocusable, lastFocusable) {
      modal.addEventListener('keydown', (e) => {
        if (e.key !== 'Tab') return;

        if (e.shiftKey) {
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      });
    }

    pageOrderModal.addEventListener('transitionend', () => {
      if (pageOrderModal.classList.contains('show')) {
        const firstFocusable = modalConfirm;
        const lastFocusable = modalCancel;
        firstFocusable.focus();
        trapFocus(pageOrderModal, firstFocusable, lastFocusable);
      }
    });

    imagePreviewModal.addEventListener('transitionend', () => {
      if (imagePreviewModal.classList.contains('show')) {
        const firstFocusable = imagePreviewClose;
        const lastFocusable = imagePreviewClose;
        firstFocusable.focus();
        trapFocus(imagePreviewModal, firstFocusable, lastFocusable);
      }
    });

    window.removeFile = removeFile;

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (imagePreviewModal.classList.contains('show')) {
          closeImagePreview();
        } else if (pageOrderModal.classList.contains('show')) {
          closeModal();
        } else if (sidebar.classList.contains('open')) {
          sidebar.classList.remove('open');
          burgerIcon.textContent = '☰';
          burgerIcon.setAttribute('aria-label', 'Open menu');
          document.body.style.overflow = '';
        }
      }
    });
  </script>
</body>
</html>